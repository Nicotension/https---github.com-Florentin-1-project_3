{% extends 'base.html.twig' %}

{% block title %}Orders index{% endblock %}

{% block body %}
<h1>Orders index</h1>

{% if is_granted('IS_AUTHENTICATED_FULLY') %}
    <table class="table">
        <thead>
            <tr>
                <th>Image</th>
                <th>Product Name</th>
                <th>Description</th>
                <th>Price</th>
				<th>Quantity</th>
				<th>Subtotal</th>
               
                
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
        {% set total = 0 %}
        {% set defaultqty = 0 %}
       
       

            {% for order in orders %}

            {% set subtotal = order.product.price * order.quantity %}
            {% set total = total + subtotal %}
            
                <tr>
                    <td>
                        {% if order.product.picture %}
                            <img src="{{ asset('uploads/' ~ order.product.picture) }}" alt="{{ order.product.name }}" width="100">
                        {% else %}
                            No image available
                        {% endif %}
                    </td>
                    
                    <td>{{ order.product.name }}</td>
                    <td>{{ order.product.description }}</td>
                    <td>{{ order.product.price }}</td>
                    <td>{{ order.quantity + defaultqty}}</td>
                   <td>{{ order.quantity * order.product.price }}</td>
                    
                    
					
					
                    <td>
                        
						<a href="{{ path('app_orders_edit', {'id': order.id}) }}">Edit Qty</a>
                        <form method="post" action="{{ path('app_orders_delete', {'id': order.id}) }}" onsubmit="return confirm('Are you sure you want to delete this item?');" style="display:inline;">
                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ order.id) }}">
                            <button class="btn">Delete</button>
                        </form>
                        {# <!-- Static PayPal Button -->
                        <button class="btn btn-primary" onclick="showPayPalButtons('{{ order.id }}', '{{ order.product.price }}')">Pay with PayPal</button>
                        <!-- PayPal Button Container -->
                        <div id="paypal-button-container-{{ order.id }}" style="display:none;"></div> #}
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="5">No records found</td>
                </tr>
				
            {% endfor %}
            

			
        </tbody>


    </table>
{% endif %}

<div class="row row-cols ">
{% if is_granted('IS_AUTHENTICATED_FULLY') %}

<div class="">

    <h4>Total : {{ total }} </hr>

    <a  class="btn btn-primary" href="{{ path ('app_payment')}}">Proceed to Payment</a>
</div>
<div class="">

    <h4>Total : {{ total }} </hr>

    <a  class="btn btn-primary" href="{{ path ('app_payment')}}">Proceed to Payment</a>
</div>

{% endif %}
</div>


<script src="https://www.paypal.com/sdk/js?client-id=YOUR_CLIENT_ID"></script>
<script>
    function showPayPalButtons(orderId, amount) {
        var containerId = 'paypal-button-container-' + orderId;
        document.getElementById(containerId).style.display = 'block';
        paypal.Buttons({
            createOrder: function(data, actions) {
                return actions.order.create({
                    purchase_units: [{
                        amount: {
                            value: amount
                        }
                    }]
                });
            },
            onApprove: function(data, actions) {
                return actions.order.capture().then(function(details) {
                    alert('Transaction completed by ' + details.payer.name.given_name);
                    // Redirect to a thank you page or update the order status in your database
                });
            }
        }).render('#' + containerId);
    }
</script>
<div>


{% endblock %}
